<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Budget Pro + Cloud Sync</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        :root {
            --accent: #7d5fff;
            --accent-glow: rgba(125, 95, 255, 0.4);
            --success: #00d2d3;
            --danger: #ff6b6b;
            --bg: #050505;
            --card-bg: rgba(255, 255, 255, 0.06);
            --input-bg: rgba(255, 255, 255, 0.08);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Plus Jakarta Sans', sans-serif; }
        body {
            background-color: var(--bg);
            background-image: radial-gradient(circle at 10% 20%, rgba(125, 95, 255, 0.1) 0%, transparent 40%);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container { width: 100%; max-width: 420px; padding: 20px; animation: fadeIn 0.8s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .glass-card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 32px;
            padding: 30px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        .balance-display { background: rgba(255,255,255,0.03); border-radius: 24px; padding: 25px; text-align: center; margin-bottom: 25px; }
        .balance-display h1 { font-size: 2.8rem; background: linear-gradient(to right, #fff, #a29bfe); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        input {
            width: 100%; padding: 16px; background: var(--input-bg); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px; color: #fff; margin-bottom: 12px; outline: none; transition: 0.3s;
        }
        input:focus { border-color: var(--accent); box-shadow: 0 0 15px var(--accent-glow); }
        .btn-primary {
            width: 100%; padding: 18px; background: var(--accent); border: none; border-radius: 18px;
            color: #fff; font-weight: 700; cursor: pointer; transition: 0.3s;
        }
        .history-list { list-style: none; max-height: 180px; overflow-y: auto; margin: 20px 0; }
        .item {
            background: rgba(255,255,255,0.03); margin-bottom: 10px; padding: 15px;
            border-radius: 15px; display: flex; justify-content: space-between; border-left: 4px solid var(--danger);
        }
        .edit-btn { background: #EAB308; padding: 5px 10px; border-radius: 8px; border:none; cursor:pointer;}
        .del-btn { background: #EF4444; color: white; padding: 5px 10px; border-radius: 8px; border:none; cursor:pointer;}
        .sync-status { font-size: 0.65rem; text-align: center; color: #888; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="container">
        <div class="glass-card">
            <h2 style="text-align:center; margin-bottom:20px; font-weight:800;">ELITE BUDGET</h2>

            <div style="display: flex; gap: 8px; margin-bottom: 20px;">
                <input type="number" id="salInput" placeholder="Set Salary" style="margin:0;">
                <button onclick="setSalary()" style="background:var(--accent); border:none; padding:0 15px; border-radius:14px; cursor:pointer; color:white;">Set</button>
            </div>

            <div class="balance-display">
                <small style="color:#888;">REMAINING</small>
                <h1 id="balDisplay">$0.00</h1>
                <div style="display:flex; justify-content:space-between; margin-top:10px; font-size:0.8rem;">
                    <span>Spent: <b id="spentDisplay" style="color:var(--danger);">$0</b></span>
                    <span>Budget: <b id="totalSal" style="color:var(--success);">$0</b></span>
                </div>
            </div>

            <ul class="history-list" id="histList"></ul>

            <input type="text" id="itemName" placeholder="Item Name">
            <input type="number" id="itemAmt" placeholder="Amount">
            
            <button class="btn-primary" id="mainBtn" onclick="handleExpense()">Deduct & Sync</button>
            <div class="sync-status" id="syncStatus">Cloud Sync Active</div>
        </div>
    </div>

    <script>
        // ==========================================
        // 1. APNA GOOGLE SCRIPT URL YAHAN PASTE KAREIN
        // ==========================================
        const GOOGLE_SHEET_URL = "https://script.google.com/macros/s/AKfycbyH5V7NPkGmEfHDODlpQLzQPbGy3mmMqXgX_esgydRpk3wgFKTEFueQHxIdVByz5HXgRg/exec";

        // 2. DATA RESTORE (Purani history ke liye)
        function restoreHistory() {
            const oldExp = localStorage.getItem('userExpenses') || localStorage.getItem('off_exp');
            const oldSal = localStorage.getItem('userSalary') || localStorage.getItem('off_sal');
            if (oldExp && !localStorage.getItem('final_exp')) localStorage.setItem('final_exp', oldExp);
            if (oldSal && !localStorage.getItem('final_sal')) localStorage.setItem('final_sal', oldSal);
        }
        restoreHistory();

        let salary = parseFloat(localStorage.getItem('final_sal')) || 0;
        let expenses = JSON.parse(localStorage.getItem('final_exp')) || [];
        let editId = null;

        // 3. SYNC FUNCTION
        function syncWithSheets(name, amount, currentSalary) {
            if (!GOOGLE_SHEET_URL.includes("http")) return;
            const status = document.getElementById('syncStatus');
            status.innerText = "Syncing with Google Sheets...";
            
            fetch(GOOGLE_SHEET_URL, {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name, amount, salary: currentSalary })
            }).then(() => {
                status.innerText = "Cloud Sync: Success âœ“";
                setTimeout(() => status.innerText = "Cloud Sync Active", 3000);
            }).catch(() => status.innerText = "Sync Failed (Offline)");
        }

        // 4. CORE FUNCTIONS
        function setSalary() {
            const val = document.getElementById('salInput').value;
            if (val > 0) {
                salary = parseFloat(val);
                localStorage.setItem('final_sal', salary);
                render();
            }
        }

        function handleExpense() {
            const name = document.getElementById('itemName').value;
            const amt = parseFloat(document.getElementById('itemAmt').value);
            if (!name || isNaN(amt)) return alert("Sahi details daalein!");

            if (editId) {
                expenses = expenses.map(e => e.id === editId ? { ...e, name, amt } : e);
                editId = null;
                document.getElementById('mainBtn').innerText = "Deduct & Sync";
            } else {
                expenses.push({ id: Date.now(), name, amt });
                syncWithSheets(name, amt, salary); // Ye line data sheet mein bhejti hai
            }
            save();
            document.getElementById('itemName').value = '';
            document.getElementById('itemAmt').value = '';
        }

        function deleteItem(id) {
            if(confirm("Delete karein?")) {
                expenses = expenses.filter(e => e.id !== id);
                save();
            }
        }

        function editItem(id) {
            const item = expenses.find(e => e.id === id);
            document.getElementById('itemName').value = item.name;
            document.getElementById('itemAmt').value = item.amt;
            editId = id;
            document.getElementById('mainBtn').innerText = "Update Entry";
        }

        function save() {
            localStorage.setItem('final_exp', JSON.stringify(expenses));
            render();
        }

        function render() {
            const list = document.getElementById('histList');
            list.innerHTML = '';
            let totalSpent = 0;
            expenses.slice().reverse().forEach(e => {
                totalSpent += e.amt;
                const li = document.createElement('li');
                li.className = 'item';
                li.innerHTML = `
                    <div><b>${e.name}</b><br><small>-$${e.amt}</small></div>
                    <div class="actions">
                        <button class="edit-btn" onclick="editItem(${e.id})">Edit</button>
                        <button class="del-btn" onclick="deleteItem(${e.id})">X</button>
                    </div>`;
                list.appendChild(li);
            });
            document.getElementById('balDisplay').innerText = `$${(salary - totalSpent).toFixed(2)}`;
            document.getElementById('spentDisplay').innerText = `$${totalSpent.toFixed(2)}`;
            document.getElementById('totalSal').innerText = `$${salary.toFixed(2)}`;
        }

        render();
    </script>
</body>
</html>


