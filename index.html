<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offline Pro Budgeter</title>
    <style>
        /* CSS Settings (Same as before for modern look) */
        :root { --primary: #6c5ce7; --success: #00b894; --danger: #ff7675; --bg: #0f0c29; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; padding: 20px; }
        .app-card { background: rgba(255,255,255,0.1); backdrop-filter: blur(15px); padding: 30px; border-radius: 20px; width: 100%; max-width: 400px; box-shadow: 0 20px 40px rgba(0,0,0,0.5); }
        input { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: none; background: rgba(255,255,255,0.1); color: white; outline: none; }
        .btn-add { width: 100%; padding: 12px; background: var(--success); border: none; color: white; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .history-item { background: rgba(255,255,255,0.05); padding: 10px; margin: 10px 0; border-radius: 8px; display: flex; justify-content: space-between; border-left: 4px solid var(--danger); }
        .btn-small { padding: 4px 8px; font-size: 0.7rem; border-radius: 4px; cursor: pointer; border: none; margin-left: 5px; color: white; }
        .edit-btn { background: #f1c40f; color: black; }
        .del-btn { background: #e74c3c; }
    </style>
</head>
<body>

    <div class="app-card">
        <h2>Offline Budget Tracker</h2>
        
        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
            <input type="number" id="salInput" placeholder="Set Salary">
            <button onclick="setSalary()" style="background:var(--primary); color:white; border:none; border-radius:8px; padding:0 15px; cursor:pointer;">Set</button>
        </div>

        <div style="text-align:center; background:rgba(0,0,0,0.2); padding:15px; border-radius:15px; margin-bottom:20px;">
            <small>Remaining</small>
            <h1 id="balDisplay">$0.00</h1>
            <div style="font-size: 0.8rem;">Spent: <span id="spentDisplay">$0</span></div>
        </div>

        <h4>History</h4>
        <ul id="histList" style="list-style:none; padding:0; max-height:200px; overflow-y:auto;"></ul>

        <input type="text" id="itemName" placeholder="What was the expense?">
        <input type="number" id="itemAmt" placeholder="Amount">
        <button class="btn-add" id="mainBtn" onclick="handleExpense()">Deduct Amount</button>
        
        <p style="text-align:center; font-size:0.7rem; margin-top:20px; color:#aaa;">Works 100% Offline</p>
    </div>

    <script>
        /* --- OFFLINE DATA LOGIC (localStorage) --- */
        let salary = parseFloat(localStorage.getItem('off_sal')) || 0;
        let expenses = JSON.parse(localStorage.getItem('off_exp')) || [];
        let editId = null;

        function setSalary() {
            const val = document.getElementById('salInput').value;
            if (val > 0) {
                salary = parseFloat(val);
                localStorage.setItem('off_sal', salary);
                render();
            }
        }

        function handleExpense() {
            const name = document.getElementById('itemName').value;
            const amt = parseFloat(document.getElementById('itemAmt').value);
            if (!name || isNaN(amt)) return alert("Sahi details dalein");

            if (editId) {
                expenses = expenses.map(e => e.id === editId ? { ...e, name, amt } : e);
                editId = null;
                document.getElementById('mainBtn').innerText = "Deduct Amount";
            } else {
                expenses.push({ id: Date.now(), name, amt });
            }

            localStorage.setItem('off_exp', JSON.stringify(expenses));
            document.getElementById('itemName').value = '';
            document.getElementById('itemAmt').value = '';
            render();
        }

        function deleteItem(id) {
            expenses = expenses.filter(e => e.id !== id);
            localStorage.setItem('off_exp', JSON.stringify(expenses));
            render();
        }

        function editItem(id) {
            const item = expenses.find(e => e.id === id);
            document.getElementById('itemName').value = item.name;
            document.getElementById('itemAmt').value = item.amt;
            editId = id;
            document.getElementById('mainBtn').innerText = "Update Expense";
        }

        function render() {
            const list = document.getElementById('histList');
            list.innerHTML = '';
            let spent = 0;
            expenses.forEach(e => {
                spent += e.amt;
                const li = document.createElement('li');
                li.className = 'history-item';
                li.innerHTML = `
                    <div><b>${e.name}</b> <br> <small>-$${e.amt}</small></div>
                    <div>
                        <button class="btn-small edit-btn" onclick="editItem(${e.id})">Edit</button>
                        <button class="btn-small del-btn" onclick="deleteItem(${e.id})">X</button>
                    </div>`;
                list.appendChild(li);
            });
            document.getElementById('balDisplay').innerText = `$${(salary - spent).toFixed(2)}`;
            document.getElementById('spentDisplay').innerText = `$${spent.toFixed(2)}`;
        }

        /* --- OFFLINE SERVICE WORKER LINKING --- */
        if ('service-worker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js');
            });
        }

        render();
    </script>
</body>
</html>
